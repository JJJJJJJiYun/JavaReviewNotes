# 十一、 Kafka

## 1. 术语

- broker：由多个 server 组成的集群，用于储存消息
- topic：消息分类方式
- partition：topic 下的的多个消息队列
- offset：每个 partition 的偏移量
- producer：生产者
- consumer：消费者

## 2. 如何保证消息的有序性

- 一个 partition 内的消息肯定是有序的，producer 指定 partition 生产消息，consumer 单线程处理
- 如果嫌单线程吞吐量低，可以根据消息的 key 起多个内存队列，多线程访问指定的内存队列

## 3. 如何保证消息的不重复消费

- 结合业务逻辑
- 如果是 mysql，增删查改，先查一下表中是否有
- 如果是 redis，直接 set
- 如果是消息，建表记录

## 4. 如何保证消息不丢失

- ACK 机制，kafka 采用的是至少一次，消息不会丢失但可能重复
- partition 复制

## 5. 为什么高吞吐

- 顺序读写，不需要硬盘磁头的寻道时间，只需很少的扇区旋转时间，所以速度远快于随机读写
- 零拷贝，建立一个磁盘空间和内存的直接映射，数据不再复制到用户态缓冲区
- 批量发送
- 数据压缩

